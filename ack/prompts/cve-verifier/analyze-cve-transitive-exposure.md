---
name: analyze-cve-transitive-exposure
description: Enhanced CVE exposure analysis for transitive dependencies and framework integration
tags: [cve, security, analysis, transitive, framework, supply-chain, cve-verifier]
---

## Input Parameters
- **cve_id**: string - CVE identifier (format: CVE-YYYY-NNNNN)
- **blackduck_csv_path**: string - Path to BlackDuck CSV file for dependency validation
- **output_directory**: string - Directory containing CVE descriptors and for saving analysis results

## Previous Steps or Phase
1. Standard CVE exposure analysis has been completed using `analyze-cve-exposure.md`
2. CVE descriptor and initial analysis files exist
3. Code consolidation files (llms-full.txt, llms.txt) exist in output directory
4. BlackDuck CSV data is available for dependency validation

## Process

1. **Validate Prerequisites**:
   - Verify standard CVE analysis exists at `{output_directory}/individual-cve-analyses/{cve_id}-analysis.json`
   - Check CVE descriptor exists at `{output_directory}/individual-cve-descriptors/{cve_id}-descriptor.json`
   - Confirm codebase files exist: `{output_directory}/llms-full.txt` and `{output_directory}/llms.txt`
   - Skip if transitive analysis already exists

2. **Generate Complete Dependency Tree**:
   - **Maven Projects**: Execute `mvn dependency:tree -DoutputFile={output_directory}/dependency-tree.txt`
   - **Gradle Projects**: Execute `gradle dependencies > {output_directory}/dependency-tree.txt`
   - **Multi-module Projects**: Generate tree for each module
   - **MANDATORY**: Save complete dependency tree output for analysis

3. **Extract Enhanced Discovery Patterns from Descriptor**:
   - Load CVE descriptor file for cve_id
   - Extract ALL existing discovery patterns (same as standard analysis)
   - **NEW**: Extract framework integration patterns:
     - `framework_integration_patterns`: Spring, web servers, middleware
     - `alternative_search_patterns`: Framework-specific usage patterns
     - `supply_chain_context`: Transitive dependency information

4. **Execute Transitive Dependency Analysis**:
   - **Search Dependency Tree**: Use `rg` to search dependency tree file for vulnerable library
     - Example: `rg "log4j:log4j:1\." {output_directory}/dependency-tree.txt`
     - Example: `rg "org.apache.xmlbeans:xmlbeans:[12]\." {output_directory}/dependency-tree.txt`
   - **Identify Transitive Paths**: For each match, extract complete dependency chain
   - **Version Analysis**: Compare found versions against affected_versions in descriptor
   - **Document Findings**: Record exact dependency paths and introducing libraries

5. **Framework Integration Pattern Search**:
   - **Spring Boot Analysis**:
     - Search for: `spring-boot-starter.*` patterns that might include vulnerable libraries
     - Look for: `@EnableAutoConfiguration`, `@SpringBootApplication` with vulnerable dependencies
     - Check: `application.properties`, `application.yml` for framework configurations
   - **Web Server Integration**:
     - Search for: Tomcat, Jetty, Undertow configurations that bundle vulnerable libraries
     - Look for: `web.xml`, server configuration files
   - **Middleware Patterns**:
     - Search for: Application server descriptors (WebLogic, JBoss, etc.)
     - Look for: OSGi bundle configurations, Karaf features
   - **Build Tool Plugins**:
     - Search for: Maven/Gradle plugins that might include vulnerable dependencies
     - Look for: Code generation plugins, packaging plugins

6. **Configuration-Based Vulnerability Detection**:
   - **Search Configuration Files**:
     - Use patterns from descriptor: `configuration_file_patterns`
     - Look for runtime configurations that enable vulnerable features
     - Example: `rg "log4j\.appender.*SocketServer" {output_directory}/llms-full.txt`
   - **Environment-Specific Analysis**:
     - Search for: Profile-specific configurations (dev, prod, test)
     - Look for: Docker, Kubernetes configurations that might expose vulnerabilities
   - **Feature Toggle Analysis**:
     - Search for: Feature flags that might enable vulnerable code paths
     - Look for: Conditional configurations based on environment variables

7. **Supply Chain Risk Assessment**:
   - **Analyze Dependency Origins**:
     - Identify which direct dependencies introduce the vulnerable transitive dependency
     - Assess upgrade impact for each introducing dependency
   - **Version Conflict Analysis**:
     - Check for version conflicts in dependency tree
     - Identify if vulnerable versions are forced by dependency management
   - **Alternative Dependency Analysis**:
     - Search for multiple versions of same library in classpath
     - Identify potential shadowing or classloader issues

8. **Enhanced Code Search with Context**:
   - **Reflection-Based Usage**:
     - Search for: `Class.forName.*{vulnerable_class}`
     - Search for: `getClass().getClassLoader().loadClass`
     - Search for: Dynamic proxy creation with vulnerable classes
   - **Annotation-Driven Usage**:
     - Search for: Framework annotations that might trigger vulnerable code
     - Example: `@Log4j`, `@Slf4j` with Log4j backend
   - **Configuration-Driven Usage**:
     - Search for: XML/YAML configurations that instantiate vulnerable classes
     - Search for: Dependency injection configurations

9. **Create Enhanced Analysis Report**:
   - **Merge with Standard Analysis**: Load existing analysis file
   - **Add Transitive Analysis Section**:
     - Dependency tree analysis results
     - Framework integration findings
     - Configuration-based exposure assessment
     - Supply chain risk evaluation
   - **Enhanced Risk Classification**:
     - **TRANSITIVE_EXPOSED**: Vulnerable via framework/transitive dependency
     - **CONFIG_EXPOSED**: Vulnerable via configuration settings
     - **FRAMEWORK_EXPOSED**: Vulnerable via framework integration
     - Update existing risk classification if needed
   - **Save Enhanced Analysis**: `{output_directory}/individual-cve-analyses/{project_name}_{cve_id}-enhanced-analysis.json`

10. **Generate Remediation Recommendations**:
    - **Direct Dependency Upgrades**: Specific version recommendations
    - **Framework Migration**: Alternative framework suggestions if needed
    - **Configuration Changes**: Specific configuration modifications to reduce risk
    - **Dependency Exclusions**: Maven/Gradle exclusion patterns
    - **Workaround Strategies**: Temporary mitigation approaches

## Output Format
- Enhanced CVE analysis file: `{output_directory}/individual-cve-analyses/{project_name}_{cve_id}-enhanced-analysis.json`
- Dependency tree analysis: `{output_directory}/dependency-tree.txt`
- Framework integration report embedded in enhanced analysis
- Supply chain risk assessment with remediation roadmap

## Output to USER
- Confirmation message: "Enhanced CVE transitive analysis completed for {cve_id}"
- Transitive dependency findings summary
- Framework integration risk assessment
- Supply chain remediation recommendations
- Enhanced analysis file location

### âœ… Enhanced CVE Analysis Complete

**Completed CVE**: {cve_id}
- **Enhanced Analysis File**: `{output_directory}/individual-cve-analyses/{project-name}_{cve_id}-enhanced-analysis.json`
- **Transitive Risk**: [Display transitive dependency findings]
- **Framework Risk**: [Display framework integration findings]
- **Supply Chain Impact**: [Display remediation complexity]

## CVE-Verifier Enhanced Domain Rules
- Rule 1: Must complete standard CVE analysis before running enhanced analysis
- Rule 2: Dependency tree generation is mandatory for all projects
- Rule 3: Framework integration patterns must be searched comprehensively
- Rule 4: Configuration-based vulnerabilities require context-aware analysis
- Rule 5: Supply chain risk assessment must include remediation impact analysis
- Rule 6: Enhanced analysis must preserve and extend standard analysis findings
