# Prompt 0-3-1: Routing Logic

## Purpose

Determine the correct size-specific orchestrator and prepare the machine-readable context package for handoff.

---

## Input

- **All artifacts 1-5** (from Workflows 0-1 and 0-2)
- **Final size classification** from `5-final-size-decision.md`
- **List of available orchestrators** in `../orchestrators/` directory

---

## Task Instructions

### Step 1: Extract Size Classification

From `5-final-size-decision.md`, extract:
- **Size Classification**: [XS / S / M / L / XL]
- **Confidence Score**: [XX%]
- **Effort Estimate**: [XX-YY person-days]

### Step 2: Select Target Orchestrator

Use the routing decision table to select the correct orchestrator:

| Size | Orchestrator File | Effort Range | Characteristics |
|------|------------------|--------------|----------------|
| **XS** | `orchestrator-XS-extra-small.md` | 1-3 days | Single file/component, no API changes, low risk |
| **S** | `orchestrator-S-small.md` | 3-7 days | Few files, simple API changes, low-medium risk |
| **M** | `orchestrator-M-medium.md` | 7-15 days | Multiple modules, moderate complexity, medium risk |
| **L** | `orchestrator-L-large.md` | 15-30 days | Cross-module changes, architecture impact, medium-high risk |
| **XL** | `orchestrator-XL-extra-large.md` | 30+ days | System-wide changes, major refactoring, high risk |

**Selected Orchestrator**: `orchestrator-[SIZE]-[name].md`

**Verify File Exists**:
- Use `file_search` to confirm: `../orchestrators/orchestrator-[SIZE]-*.md`
- If file exists: Proceed
- If file doesn't exist: ERROR - report missing orchestrator file

### Step 3: Prepare Context Package Metadata

Gather all essential information for the context package:

**Change Request Information**:
- Change Request ID (from `1-change-request-summary.md`)
- Change Title/Description
- Requestor and Stakeholders

**Size Classification**:
- Size: [XS/S/M/L/XL]
- Confidence: [XX%]
- Total Matrix Score: [XX/25]

**Scope Metrics**:
- Estimated Effort: [XX-YY days]
- Files Affected: [XX-YY]
- Modules Affected: [X]
- Estimated LOC: [X,XXX-Y,YYY]

**Risk Summary**:
- Business Risk: [H/M/L]
- Technical Risk: [H/M/L]
- Security Risk: [H/M/L]
- Operational Risk: [H/M/L]

**Dependencies**:
- Internal Integrations: [list]
- External Integrations: [list]

### Step 4: Generate Context Package YAML

Create the machine-readable handoff package:

```yaml
# Context Package for Change Request Routing
# Generated by: Orchestrator-0-Router v2.0 / Prompt 0-3-1

change_request:
  id: "SACP-XXXXXX"
  title: "[Change title from artifact 1]"
  requestor: "[Requestor from artifact 1]"
  priority: "[Priority from artifact 1]"
  due_date: "YYYY-MM-DD"

sizing:
  classification: "L"  # XS/S/M/L/XL
  confidence_score: 85  # percentage
  matrix_score: 19  # out of 25
  effort_estimate:
    min_days: 20
    max_days: 30
    breakdown:
      development: 50%  # percentage
      testing: 25%
      review: 10%
      documentation: 10%
      deployment: 5%

routing:
  target_orchestrator: "orchestrator-L-large.md"
  routing_timestamp: "2025-01-08T10:30:00Z"
  routed_by: "orchestrator-0-router"
  workflow_version: "2.0"

artifacts:
  - file: "1-change-request-summary.md"
    type: "business_context"
    description: "Business objectives, stakeholders, requirements"
  
  - file: "2-technical-scope-analysis.md"
    type: "technical_analysis"
    description: "Modules, files, LOC, API/DB changes, integrations"
  
  - file: "3-risk-assessment.md"
    type: "risk_analysis"
    description: "Business, technical, security, operational risks"
  
  - file: "4-size-evaluation-matrix.md"
    type: "sizing_matrix"
    description: "5-dimension scoring (XX/25 points)"
  
  - file: "5-final-size-decision.md"
    type: "size_decision"
    description: "Size classification, confidence, effort estimate"

scope_metrics:
  files_affected:
    min: 40
    max: 50
  modules_affected: 8
  estimated_loc:
    min: 6000
    max: 8000
  api_changes:
    new_endpoints: 5
    modified_endpoints: 3
    breaking_changes: 0
  database_changes:
    new_tables: 2
    modified_tables: 3
    migrations_required: true

risk_profile:
  business_risk: "Medium"
  technical_risk: "Medium"
  security_risk: "Medium"
  operational_risk: "Medium"
  overall_risk: "Medium"
  top_risks:
    - "Cross-module coordination complexity"
    - "Database migration without rollback"
    - "Multiple external system integrations"

dependencies:
  internal_systems:
    - "bird-deploymentmanager-services"
    - "bird-notification-ms-teams"
    - "bird-aqd-client"
    - "Flowable BPMN engine"
  external_systems:
    - "AQD (Architecture Quality Dashboard)"
    - "OMS (Operational Management System)"
  coordination_required:
    - "OMS Team"
    - "A2E Team"
    - "Platform Team"

handoff_instructions:
  - "Review all 5 artifacts before starting specification"
  - "Pay attention to cross-module dependencies listed in artifact 2"
  - "Coordinate with OMS, A2E, and Platform teams early"
  - "Plan for database schema changes and migration strategy"
  - "Ensure compliance with AQD validation requirements"

key_assumptions:
  - "[Assumption 1 from artifact 5]"
  - "[Assumption 2 from artifact 5]"

unknowns:
  - "[Unknown 1 from artifact 5]"
  - "[Unknown 2 from artifact 5]"

metadata:
  generated_date: "YYYY-MM-DD"
  generated_by: "prompt-0-3-1-routing-logic"
  workspace: "bird-java-api"
  project_complexity: "Complex"
```

**Output File**: `6-context-package.yaml`

---

## Output Format

Generate `6-context-package.yaml` using the structure above. Populate ALL fields with actual data from artifacts 1-5.

---

## Success Criteria

- [ ] Size classification extracted correctly
- [ ] Target orchestrator selected using decision table
- [ ] Orchestrator file existence verified
- [ ] All artifacts referenced in YAML
- [ ] All metrics populated from artifacts 1-5
- [ ] Risk profile summarized
- [ ] Dependencies listed
- [ ] Handoff instructions are specific and actionable
- [ ] YAML is valid and complete
- [ ] Output file created: `6-context-package.yaml`

---

## Tools to Use

- `read_file`: Read artifacts 1-5 to extract data
- `file_search`: Verify orchestrator file exists (`../orchestrators/orchestrator-[SIZE]-*.md`)
- `create_file`: Generate `6-context-package.yaml`

---

## Exit Criteria

Declare: **"Step 3.1 complete. Context package YAML generated. Proceeding to Step 3.2 (Routing Documentation)."**

---

## Version History

- **v1.0** (2025-01-08): Initial prompt creation from orchestrator-0-router.md v1.0

---

**Next Prompt**: `prompt-0-3-2-routing-documentation.md`
